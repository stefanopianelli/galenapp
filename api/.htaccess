# Impedisce il listing dei file nelle cartelle
Options -Indexes

# --- GESTIONE CORS E PREFLIGHT (OPTIONS) ---
# Necessario se il frontend è su un dominio/sottodominio diverso dal backend
<IfModule mod_headers.c>
    # In produzione è meglio specificare il dominio invece di '*'
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, DELETE, PUT"
    Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
</IfModule>

# Se la richiesta è OPTIONS (Preflight), restituisci 200 OK e ferma qui
RewriteEngine On
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# --- PROTEZIONE FILE SENSIBILI ---
# Protezione globale per file di configurazione, SQL e log
<FilesMatch "\.(php|sql|env|log)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Eccezione: Permetti l'accesso solo al file api.php (necessario per il funzionamento)
<Files "api.php">
    Order allow,deny
    Allow from all
</Files>

# Eccezione temporanea per il setup (scommentare se necessario)
<Files "setup_database.php">
   Order allow,deny
   Allow from all
</Files>

# Eccezione per migrazione tolleranza (necessaria per aggiornare DB)
<Files "migration_tolerance.php">
   Order allow,deny
   Allow from all
</Files>